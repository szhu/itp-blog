[{"insert":"Intangible Interactions Week 5\nProject 2 Curious Cube progress"},{"attributes":{"header":1},"insert":"\n"},{"insert":"My previous idea for Curious Cube primarily involved projected a full-sized room into a desk-sized room. This week, thought about, in particular, the feedback I received about fleshing out the interaction part of the project.\nI decided to change the project slightly to focus on the interaction part. The new idea is a model room that can control a real room when the user interacts with it â€” a \"voodoo doll room\" of sorts, but my project will support just a single case of this, to keep things simple.\nI revisited "},{"attributes":{"link":"https://./2021-02-24-intangible.html"},"insert":"my original, original Curious Cube idea"},{"insert":" and realized that I can make something similar, albeit with the two rooms analogy. My project will dim and brighten the real room based on the brightness of the small, cube room. The cube room be a (now statically-decorated) cube with a light sensor, and the real room's brightness will be controlled using a smart home light, controlled from the Arduino via Bluetooth.\nThis week, I made a proof of concept of this. There is no cube, but I am testing the sensor that cube will use. There is no output in the real room yet, while I figure out which smart light bulb to purchase and while I wait for it to arrive, so we simulate the lighting of the room on a computer screen.\nHere's what it looks like so far:\n"},{"insert":{"attachment":[{"name":"IMG_2797.opt.mp4","size":3095123,"source":"https://static.slab.com/prod/uploads/xrfkaonr/posts/attachments/K87MXv32XedKlcZevauaaylr.mp4"}]}},{"insert":"Code"},{"attributes":{"header":2},"insert":"\n"},{"attributes":{"code":true},"insert":"index.html"},{"insert":":\n<html>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  <style>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-size: cover;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-position: center;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      transition: background-image 0.1s linear;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html[data-brightness=\"0\"] {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-image: url(\"https://i.imgur.com/BtVEOTW.jpg\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html[data-brightness=\"1\"] {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-image: url(\"https://i.imgur.com/bHNnHLG.jpg\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html[data-brightness=\"2\"] {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-image: url(\"https://i.imgur.com/SqwcxPb.jpg\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html[data-brightness=\"3\"] {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-image: url(\"https://i.imgur.com/ug6ygWM.jpg\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    html[data-brightness=\"4\"] {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      background-image: url(\"https://i.imgur.com/yrcBhE3.jpg\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    /*"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/BtVEOTW.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/bHNnHLG.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/SqwcxPb.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/ug6ygWM.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/yrcBhE3.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/T73kW7u.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/T0cv4Pw.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/BUzah8v.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/4lnL4KP.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/DK1RcjA.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/bKNslxS.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/tdmYEwc.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/QuHITfl.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/iMd0ey0.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/C8b6IMU.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     * \"https://i.imgur.com/5Xq4Yun.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"     */"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  </style>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  <script>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    // Preload background images"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    // https://stackoverflow.com/a/1374936/782045"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    for (let img of ["},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      \"https://i.imgur.com/BtVEOTW.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      \"https://i.imgur.com/bHNnHLG.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      \"https://i.imgur.com/SqwcxPb.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      \"https://i.imgur.com/ug6ygWM.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      \"https://i.imgur.com/yrcBhE3.jpg\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    ]) {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      new Image().src = img;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"    setInterval(async () => {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      let response = await fetch(\"/\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      let brightness = response.headers.get(\"brightness\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      let index = Math.max(0, Math.min(4, Math.floor(brightness / 40 - 1)));"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      document.documentElement.setAttribute(\"data-brightness\", index);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }, 100);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  </script>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  <body>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    <title>Fiat Lux</title>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    <img />"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  </body>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"</html>"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"attributes":{"code":true},"insert":"main.ts"},{"insert":":\nimport mergeRace from \"https://jspm.dev/@async-generator/merge-race@1.0.3\";"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"import { readLines } from \"https://deno.land/std@0.77.0/io/bufio.ts\";"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"import { serve } from \"https://deno.land/std@0.89.0/http/server.ts\";"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"const server = serve({ hostname: \"0.0.0.0\", port: 8080 });"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"console.log(`HTTP webserver running.  Access it at:  http://localhost:8080/`);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"let bodyContent = await Deno.readTextFile(\"index.html\");"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"let brightness = 0;"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"if (import.meta.main) {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  let serialProcess = Deno.run({"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    cmd: [\"make\", \"monitor\"],"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    stdout: \"piped\","},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  });"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  for await (let item of (mergeRace as any)("},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    readLines(serialProcess.stdout),"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    server"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  )) {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    if (typeof item === \"string\") {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      // From readLines"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      let line = item;"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"      let m = line.match(/(\\d+),(\\d+),(\\d+),(\\d+)/);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      if (m) {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        let [_, sr, sg, sb, sc] = m;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        let [r, g, b, c] = [sr, sg, sb, sc].map(parseFloat);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        brightness = c;"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        console.log(brightness);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      } else {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        console.log(line);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    } else {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      // From server"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      let request = item;"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"      request.respond({"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        status: 200,"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        headers: new Headers(["},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"          [\"content-type\", \"text/html\"],"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"          [\"brightness\", `${brightness}`],"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        ]),"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"        body: bodyContent,"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"      });"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"attributes":{"code":true},"insert":"project-2.ino"},{"insert":":\n#include \"Arduino_APDS9960.h\""},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"void setup() {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  Serial.begin(9600);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  // wait for Serial Monitor to open:"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  while (!Serial)"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    ;"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  Serial.println(\"hi\");"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  // if the sensor doesn't initialize, let the user know:"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  while (!APDS.begin()) {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.println(\"APDS9960 sensor not working. Check your wiring.\");"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"    delay(1000);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  Serial.println(\"Sensor is working\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"void loop() {"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  // red, green, blue, clear channels:"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  int r, g, b, c;"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"  // if the sensor has a reading:"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  if (APDS.colorAvailable()) {"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"    // read the color"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    APDS.readColor(r, g, b, c);"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"    // print the values"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(r);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(\",\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(g);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(\",\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(b);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.print(\",\");"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"    Serial.println(c);"},{"attributes":{"code-block":"plain"},"insert":"\n\n"},{"insert":"    delay(100);"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"  }"},{"attributes":{"code-block":"plain"},"insert":"\n"},{"insert":"}"},{"attributes":{"code-block":"plain"},"insert":"\n"}]
